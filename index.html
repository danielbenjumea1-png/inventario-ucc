<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventario con Escáner de Códigos</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 20px; background-color: #f4f4f4; color: #333; text-align: center; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        h1 { color: #007bff; }
        #interactive { width: 100%; max-width: 640px; height: 480px; border: 2px solid #007bff; border-radius: 5px; margin: 20px auto; display: block; }
        .verde { background-color: #d4edda; color: #155724; }
        .morado { background-color: #e2e3e5; color: #383d41; }
        table { border-collapse: collapse; width: 100%; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        th { background-color: #007bff; color: white; }
        button { margin: 10px; padding: 12px 20px; background-color: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; transition: background 0.3s; }
        button:hover { background-color: #0056b3; }
        button:disabled { background-color: #ccc; cursor: not-allowed; }
        input { padding: 10px; width: 250px; border: 1px solid #ccc; border-radius: 5px; margin: 10px; }
        #result { margin: 20px 0; font-weight: bold; }
        .description { background: #e9ecef; padding: 15px; border-radius: 5px; margin-bottom: 20px; }
        .modal { display: none; position: fixed; z-index: 1; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.4); }
        .modal-content { background-color: #fefefe; margin: 15% auto; padding: 20px; border: 1px solid #888; width: 80%; max-width: 600px; border-radius: 10px; }
        .close { color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
        .close:hover { color: black; }
    </style>
    <!-- Librerías externas -->
    <script src="https://cdn.jsdelivr.net/npm/quagga@0.12.1/dist/quagga.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>Inventario con Escáner de Códigos de Barras</h1>
        <div class="description">
            <h3>Descripción de la App</h3>
            <p>Esta aplicación te permite escanear códigos de barras (que empiecen con 'B') usando la cámara de tu dispositivo. Verifica si el código existe en tu inventario cargado desde Excel, lo marca como "encontrado" (verde) y actualiza la tabla. Puedes ingresar códigos manualmente, descargar el inventario actualizado o subirlo a SharePoint. Ideal para inventarios rápidos y precisos.</p>
        </div>
        <button onclick="mostrarGuia()">Guía de Uso</button>
        <div id="interactive"></div>
        <div id="result"></div>
        <input type="text" id="codigoManual" placeholder="Ingresa código manualmente (ej. B123456)">
        <br>
        <button onclick="procesarManual()" title="Procesa el código ingresado manualmente">Procesar Código Manual</button>
        <button onclick="descargarExcel()" title="Descarga el inventario actualizado como archivo Excel">Descargar Inventario (Excel)</button>
        <button onclick="subirSharePoint()" title="Descarga el Excel y sube manualmente a SharePoint">Subir a SharePoint</button>
        <button onclick="resetearInventario()" title="Borra todo el inventario y recarga desde Excel inicial">Resetear Inventario</button>
        <table id="inventarioTable">
            <thead>
                <tr><th>Código</th><th>Estado</th></tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <!-- Modal para Guía de Uso -->
    <div id="guiaModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="cerrarGuia()">&times;</span>
            <h2>Guía de Uso</h2>
            <ol>
                <li><strong>Cargar Inventario Inicial:</strong> Sube tu Excel antiguo a GitHub (ver instrucciones abajo) para que la app lo importe automáticamente al cargar.</li>
                <li><strong>Escanear Códigos:</strong> Permite acceso a la cámara y apunta al código de barras. Solo se procesan códigos que empiecen con 'B' y tengan al menos 7 caracteres.</li>
                <li><strong>Procesar Manualmente:</strong> Ingresa un código en el campo de texto y haz clic en "Procesar Código Manual".</li>
                <li><strong>Ver Resultados:</strong> Los códigos encontrados se marcan en verde en la tabla. Nuevos códigos se agregan en morado.</li>
                <li><strong>Descargar Excel:</strong> Guarda el inventario actualizado en tu dispositivo.</li>
                <li><strong>Subir a SharePoint:</strong> Descarga el Excel y súbelo manualmente al enlace proporcionado.</li>
                <li><strong>Resetear:</strong> Borra el inventario local y recarga desde el Excel inicial.</li>
            </ol>
            <p><strong>Nota:</strong> Los datos se guardan en tu navegador (localStorage). Si cierras la app, se pierden a menos que descargues el Excel.</p>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
